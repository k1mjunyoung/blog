{"componentChunkName":"component---src-templates-post-jsx","path":"/jpa-bulk-update/","result":{"data":{"site":{"siteMetadata":{"title":"ê¹€ì¤€ì˜ì˜ ê¸°ìˆ ë¸”ë¡œê·¸"}},"markdownRemark":{"id":"c97845d8-df86-56e6-8ec4-15770411357d","excerpt":"ë§ˆì£¼í•œ ì´ìŠˆ JPAë¡œ Listë¥¼ ë°›ì•„ì™€ì„œ ìˆ˜ì • í›„  í•˜ëŠ” ê¸°ì¡´ ë¡œì§ì—ì„œ hibernate ë¡œê·¸ê°€ ìˆ˜ì—†ì´ ëœ¨ëŠ” ê±¸ ë°œê²¬, JPAê°€ ë°ì´í„° ìˆ˜ë§Œí¼ ê±´ë³„ë¡œ Updateí•˜ê¸° ë•Œë¬¸ Bulk update ë²Œí¬ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ì„   ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. SpringDataJPAê°€ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ ë©”ì†Œë“œê°€ SELECTë¬¸ì¸ì§€ UPDATEë¬¸ì¸ì§€ ì•Œì•„ì•¼ Return Tâ€¦","html":"<h2>ë§ˆì£¼í•œ ì´ìŠˆ</h2>\n<p>JPAë¡œ Listë¥¼ ë°›ì•„ì™€ì„œ ìˆ˜ì • í›„ <code class=\"language-text\">saveAll()</code> í•˜ëŠ” ê¸°ì¡´ ë¡œì§ì—ì„œ hibernate ë¡œê·¸ê°€ ìˆ˜ì—†ì´ ëœ¨ëŠ” ê±¸ ë°œê²¬, JPAê°€ ë°ì´í„° ìˆ˜ë§Œí¼ ê±´ë³„ë¡œ Updateí•˜ê¸° ë•Œë¬¸</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tbl080Block</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByRejectNum</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> rejectNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Bulk update</h2>\n<p>ë²Œí¬ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ì„  <code class=\"language-text\">@Modifying</code> ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>\n<blockquote>\n<p>SpringDataJPAê°€ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ ë©”ì†Œë“œê°€ SELECTë¬¸ì¸ì§€ UPDATEë¬¸ì¸ì§€ ì•Œì•„ì•¼ Return Typeì„ ê²°ì •í•˜ëŠ”ë°, ì•„ì§ì€ ë‚´ë¶€ì ìœ¼ë¡œ Queryë§Œ ë³´ê³  íŒë‹¨ì„ ëª»í•´ì„œ, ëª…ì‹œë¥¼ í•´ì¤˜ì•¼ Return typeì„ ê²°ì •í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Modifying</span>\n<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"UPDATE TBL_080_BLOCK SET EXP_DT = :nowDt WHERE REJECT_NUM = :rejectNum\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">updateExpDtByRejectNum</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rejectNum\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> rejectNum<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nowDt\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">LocalDateTime</span> nowDt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­</h3>\n<p>ë²Œí¬ ì—…ë°ì´íŠ¸ë¥¼ í•  ë•Œ, ì£¼ì˜ì‚¬í•­ì´ ìˆë‹¤.</p>\n<p>1ì°¨ ìºì‹œë¼ê³  ë¶ˆë¦¬ëŠ” <strong>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸</strong> ë•Œë¬¸ì¸ë°, <strong>ë²Œí¬ ì—…ë°ì´íŠ¸ëŠ” ë‹¨ì¼ ì—…ë°ì´íŠ¸ì™€ ë‹¤ë¥´ê²Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤.</strong></p>\n<blockquote>\n<p>ë‚´ë¶€ì ì¸ ë™ì‘ì€ ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.</p>\n<ol>\n<li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—”í„°í‹° 2ê°œë¥¼ ì¶”ê°€ + ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— INSERTë¬¸ ì €ì¥</li>\n<li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ flush(JPQL ì‹¤í–‰ ë•Œë¬¸) ->Â <strong>ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì—ë§Œ UPDATEë¬¸ ì €ì¥</strong></li>\n<li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì—”í„°í‹° ì¡°íšŒ</li>\n<li>Updateë¬¸ì´ ì ìš©ë˜ì§€ ì•Šì€ ê°’ì„ ë°˜í™˜</li>\n</ol>\n</blockquote>\n<p>í•´ê²°ë°©ë²•ì€ ë²Œí¬ ì—…ë°ì´íŠ¸ë¡œ ì¸í•´ ë³€ê²½ëœ ê°’ì„ ì°¸ì¡°í•´ì•¼ í•œë‹¤ë©´, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ DBì— ë°˜ì˜í•˜ê³  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ì›Œì•¼ í•œë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´, í•´ë‹¹ ê°’ì„ ì°¸ì¡°í•  ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ DBì— ì§ì ‘ ì ‘ê·¼í•˜ê²Œ ë˜ì–´ì„œ ë°˜ì˜ëœ(ì—…ë°ì´íŠ¸ëœ) ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>\n<p><code class=\"language-text\">@Modifying</code> ì˜ <code class=\"language-text\">clearAutomatically</code> ì˜µì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Modifying</span><span class=\"token punctuation\">(</span>clearAutomatically <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"UPDATE TBL_080_BLOCK SET EXP_DT = :nowDt WHERE REJECT_NUM = :rejectNum\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">updateExpDtByRejectNum</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rejectNum\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> rejectNum<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nowDt\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">LocalDateTime</span> nowDt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>íŠ¸ëœì ì…˜?</h3>\n<p>ìœ„ì™€ ê°™ì´ ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë¥¼ ì ìš©í•˜ë‹ˆ ë˜ ë‹¤ë¥¸ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ë°, Transaction ê´€ë ¨ ì—ëŸ¬ì˜€ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">javax.persistence.TransactionRequiredException:Executing an update/delete query </code></pre></div>\n<p><code class=\"language-text\">@Transactional</code> ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë‹ˆ í•´ê²°ë˜ì—ˆëŠ”ë° íŠ¸ëœì­ì…˜ì— ëŒ€í•œ ê³µë¶€ëŠ” ì¶”í›„ì—..</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@Modifying</span><span class=\"token punctuation\">(</span>clearAutomatically <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"UPDATE TBL_080_BLOCK SET EXP_DT = :nowDt WHERE REJECT_NUM = :rejectNum\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">updateExpDtByRejectNum</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rejectNum\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> rejectNum<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nowDt\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">LocalDateTime</span> nowDt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>[ì°¸ê³ ] <a href=\"https://jaehoney.tistory.com/151\">https://jaehoney.tistory.com/151</a></p>","frontmatter":{"title":"ğŸ’ª JPA ëŒ€ëŸ‰ ë°ì´í„° í•œë²ˆì— UPDATEí•˜ê¸°","date":"March 29, 2024","update":null,"tags":["jpa"],"series":null},"fields":{"slug":"/jpa-bulk-update/","readingTime":{"minutes":3.05}}},"seriesList":{"edges":[{"node":{"id":"c9468df6-f697-5562-acc9-c32d901d5c22","fields":{"slug":"/clean-code/"},"frontmatter":{"title":"ğŸ” í´ë¦°ì½”ë“œ í›‘ì–´ë³´ê¸°"}}},{"node":{"id":"cc30409f-f6be-5aeb-8e8b-abc91ad74891","fields":{"slug":"/oop/"},"frontmatter":{"title":"ğŸŸ ê°ì²´ëŠ” ë¶•ì–´ë¹µì´ ì•„ë‹™ë‹ˆë‹¤"}}},{"node":{"id":"0b702e91-b3b6-5698-8d9b-c98049554b92","fields":{"slug":"/rabbitMQ/"},"frontmatter":{"title":"ğŸ’¬ ë©”ì„¸ì§€ íì™€ RabbitMQ"}}},{"node":{"id":"c97845d8-df86-56e6-8ec4-15770411357d","fields":{"slug":"/jpa-bulk-update/"},"frontmatter":{"title":"ğŸ’ª JPA ëŒ€ëŸ‰ ë°ì´í„° í•œë²ˆì— UPDATEí•˜ê¸°"}}}]},"previous":{"fields":{"slug":"/rabbitMQ/"},"frontmatter":{"title":"ğŸ’¬ ë©”ì„¸ì§€ íì™€ RabbitMQ"}},"next":null},"pageContext":{"id":"c97845d8-df86-56e6-8ec4-15770411357d","series":null,"previousPostId":"0b702e91-b3b6-5698-8d9b-c98049554b92","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}